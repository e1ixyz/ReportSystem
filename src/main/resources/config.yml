# === ReportSystem – Default Configuration ===

# ------------------------------------------------------------------------------------
# CORE
# ------------------------------------------------------------------------------------
allow-self-report: true                  # Allow players to report themselves?
stack-window-seconds: 600                # Seconds to merge ("stack") identical reports (same target/type/category)
export-html-chatlog: true                # If true, chat logs export to HTML (used when web viewer is enabled)
html-export-dir: "html-logs"             # Folder under the plugin data directory for HTML exports
reports-per-page: 10
staff-join-summary-delay-ticks: 40          # Delay before sending staff summary on join (ticks)

# ------------------------------------------------------------------------------------
# STORAGE BACKEND
# ------------------------------------------------------------------------------------
storage:
  mode: filesystem                 # filesystem or mysql
  mysql:
    host: "127.0.0.1"
    port: 3306
    database: "reportsystem"
    username: "reports"
    password: "password"
    params: "?useSSL=false&characterEncoding=utf8"
    table: "rs_reports"

# Permissions
staff-permission: "reportsystem.reports"          # Staff can use /reports, bypass cooldown, view protected web pages, etc.
notify-permission: "reportsystem.notify"          # Staff who should receive ingame notifications about new reports
force-claim-permission: "reportsystem.forceclaim" # Staff who may override someone else’s claim
admin-permission: "reportsystem.admin"            # Admin-only: /reports reload, /reports logoutall, force-claim override fallback

# ------------------------------------------------------------------------------------
# REPORT COOLDOWN
# ------------------------------------------------------------------------------------
# Players must wait this long between /report commands.
# Users with staff-permission bypass this cooldown.
report-cooldown-seconds: 60

# ------------------------------------------------------------------------------------
# INLINE PREVIEW (safe inline chat previews)
# ------------------------------------------------------------------------------------
preview-lines: 10
preview-line-max-chars: 200

# ------------------------------------------------------------------------------------
# PUBLIC URLS FOR LINKS SHOWN IN CHAT
# ------------------------------------------------------------------------------------
# Leave blank by default (no private domain committed). If you have a public domain later,
# set EITHER public-base-url OR http-server.external-base-url (prefer public-base-url).
public-base-url: ""                      # e.g. "https://reports.example.com"

http-server:
  enabled: false                         # Built-in tiny web server to serve html-logs/
  external-base-url: ""                  # e.g. "https://reports.example.com" (used for links when public-base-url is blank)
  bind: "0.0.0.0"                        # Listen address
  port: 8085
  base-path: "/"                         # Mount path (keep "/" unless you know you need a subpath)

# ------------------------------------------------------------------------------------
# LIGHTWEIGHT WEB AUTH FOR HTTP SERVER
# ------------------------------------------------------------------------------------
auth:
  enabled: false
  cookie-name: "rsid"
  session-ttl-minutes: 1440              # Sliding session TTL (minutes)
  code-ttl-seconds: 120                  # One-time code lifetime (seconds) for /reports auth
  code-length: 6
  secret: "change-me"                    # Change in production; used for signing session ids
  open-paths:                            # Paths accessible without auth (when auth is enabled)
    - "/login"
    - "/favicon.ico"
  require-permission: true               # Require staff-permission to run /reports auth and receive a code

# ------------------------------------------------------------------------------------
# DISCORD WEBHOOK (optional)
# ------------------------------------------------------------------------------------
discord:
  enabled: false
  webhook-url: ""
  username: "ReportSystem"
  avatar-url: ""
  timeout-ms: 4000

# ------------------------------------------------------------------------------------
# MULTI-FACTOR PRIORITY SCORING
# ------------------------------------------------------------------------------------
# Effective Score = Sum( weight_i * factor_i ), for enabled factors only.
priority:
  enabled: true

  # Enable/Disable individual factors
  use-count: true
  use-recency: true
  use-severity: true
  use-evidence: true
  use-unassigned: true
  use-aging: true
  use-sla-breach: true

  # Weights (importance)
  w-count: 2.0
  w-recency: 2.0
  w-severity: 3.0
  w-evidence: 1.0
  w-unassigned: 0.5
  w-aging: 1.0
  w-sla-breach: 4.0

  # Shaping
  tau-ms: 900000           # 15 minutes exponential time constant for recency decay

  # Severity map "<typeId>/<categoryId>": weight
  severity-by-key:
    "player/cheat": 3.0
    "server/crash": 2.5
    "player/chat": 1.0
    "player/ad": 1.5

  # SLA targets (minutes)
  sla-minutes:
    "player/cheat": 5
    "server/crash": 2
    "player/chat": 15

# ------------------------------------------------------------------------------------
# QUICK ACTION BUTTONS UNDER /reports
# ------------------------------------------------------------------------------------
# Customize the buttons shown beneath the /reports overview. Each entry supports:
#   command   - required; run when the button is clicked
#   label     - optional inline label (fall back to label-key if omitted)
#   hover     - optional hover text (fall back to hover-key if omitted)
#   color     - MiniMessage color/format tag to wrap the label (default "<aqua>")
#   permission- optional permission required to see the button
#   click     - run_command, suggest_command, or open_url (default run_command)
#   label-key / hover-key - reuse messages.* entries for translation
reports-actions:
  - command: "/reports claim"
    label-key: "button-claim-highest"
    hover-key: "tip-claim-highest"
    color: "<green>"
  - command: "/reports claimed"
    label-key: "button-claimed"
    hover-key: "tip-claimed-list"
    color: "<aqua>"
  - command: "/reporthistory"
    label-key: "button-reporthistory"
    hover-key: "tip-reporthistory"
    color: "<gold>"

# ------------------------------------------------------------------------------------
# MESSAGES / LOCALIZATION
# ------------------------------------------------------------------------------------
messages:
  prefix: "<gray>[<blue>Reports</blue>]</gray> "
  no-permission: "<red>You don't have permission.</red>"

  # /report UX
  usage-report: "Usage: /report <type> <category> [<target>] <reason...>"
  invalid-type: "Unknown type or category: %type%/%cat%"
  self-report-denied: "You cannot report yourself."
  report-stacked: "Report stacked into #%id% (now x%count%)"
  report-filed: "Report filed! (ID #%id%)"
  report-cooldown: "<red>You must wait %seconds% seconds before filing another report.</red>"

  # Common
  not-found: "No such report: #%id%"
  closed: "Closed report #%id%"
  assigned: "Assigned report #%id% to %assignee%"
  unassigned: "Unassigned report #%id%"
  already-unassigned: "Report #%id% is not assigned."
  search-empty: "No matching reports."
  search-header: "Search: %query% (%scope%)"
  page-empty: "No open reports."
  page-header: "Reports Page %page%/%pages%"
  page-header-filtered: "Reports (%type%/%cat%) Page %page%/%pages%"
  reloaded: "ReportSystem reloaded."
  chatlog-none: "No chat messages were captured for this report."
  claim-none: "<gray>No claimable reports available.</gray>"
  force-claimed: "<gray>You force-claimed report <white>#%id%</white>.</gray>"
  page-start: "<gray>You're already on the first page.</gray>"
  page-end: "<gray>You're already on the last page.</gray>"
  staff-join-summary: "<gray>Reports summary:</gray> %open% <gray>•</gray> %claimed% <gray>•</gray> %closed%."
  summary-open-label: "%count% open"
  summary-claimed-label: "%count% claimed"
  summary-closed-label: "%count% closed"
  summary-open-color: "<white>"
  summary-claimed-color: "<white>"
  summary-closed-color: "<white>"
  summary-open-tip: "View open reports"
  summary-claimed-tip: "View your claimed reports"
  summary-closed-tip: "View closed reports"
  reports-unknown-category: "<red>Unknown category for type '%type%': %category%</red>"
  reports-no-open: "<red>No such open report.</red>"
  reports-claim-success: "<gray>You claimed report <white>#%id%</white>.</gray>"
  reports-force-claim-required: "<red>Already claimed by %assignee% (need force-claim).</red>"
  reports-claimed-empty: "<gray>You have no claimed reports.</gray>"
  reports-claimed-header: "<gray>Your claimed reports:</gray>"
  reports-claimed-entry: "%row%  <gray>[</gray><aqua><hover:show_text:'%expand_tip%'><click:run_command:'/reports view %id%'>%expand_label%</click></hover></aqua><gray>]</gray>"
  reports-list-entry: "%row%  <gray>[</gray><aqua><hover:show_text:'%expand_tip%'><click:run_command:'/reports view %id%'>%expand_label%</click></hover></aqua><gray>]</gray>"
  reports-chatlog-misconfigured: "<red>Web viewer is enabled but external/public base URL is not configured.</red>"
  reports-chatlog-export-failed: "<red>Failed to export HTML chat log:</red> <gray>%error%</gray>"
  reports-chat-header: "<gray>Chat for #%id% — page %page%/%pages% (%total% lines):</gray>"
  reports-chat-line: "<gray>%line%</gray>"
  reports-search-more: "<gray>…and %count% more.</gray>"
  reports-priority-disabled: "<gray>Priority scoring is disabled; ordering falls back to <white>%tiebreaker%</white>.</gray>"
  reports-priority-total: "<gray>Priority for <white>#%id%</white>: <green>%score%</green></gray>"
  reports-priority-empty: "<gray>No contributing factors (all weights zero or disabled).</gray>"
  reports-priority-tiebreaker: "<gray>Tie-breaker after priority: <white>%tiebreaker%</white>.</gray>"
  reports-notify-summary: "<yellow>New report:</yellow> <white>#%id%</white> <gray>(%type% / %category%)</gray> <white>%target%</white> — <gray>%reason%</gray> %expand%"
  reports-notify-expand-button: "<gray>[</gray><aqua><hover:show_text:'%expand_tip%'><click:run_command:'/reports view %id%'>%expand_label%</click></hover></aqua><gray>]</gray>"
  reports-assign-self: "<gray>Assigned report <white>#%id%</white> to you.</gray>"
  reports-unassign-self: "<gray>Unassigned report <white>#%id%</white>.</gray>"
  reports-unassign-not-owner: "<red>You are not the assignee for #%id%.</red>"
  error-players-only: "<red>Players only.</red>"
  error-players-only-auth: "<red>Only players can request a login code.</red>"
  error-players-only-logout: "<red>Only players can logout their sessions.</red>"
  error-admin-permission: "<red>Admin permission required.</red>"
  auth-code-failed: "<red>Unable to generate an auth code. Do you have permission?</red>"
  auth-logoutall-success: "<gray>Revoked <white>%count%</white> web session(s).</gray>"
  usage-reports-view: "<yellow>Usage:</yellow> /reports view <id>"
  usage-reports-close: "<yellow>Usage:</yellow> /reports close <id>"
  usage-reports-chat: "<yellow>Usage:</yellow> /reports chat <id> [page]"
  usage-reports-assign: "<yellow>Usage:</yellow> /reports assign <id> <staff>"
  usage-reports-unassign: "<yellow>Usage:</yellow> /reports unassign <id>"
  usage-reports-search: "<yellow>Usage:</yellow> /reports search <query> [open|closed|all]</yellow>"
  usage-reports-debug: "<yellow>Usage:</yellow> /reports debug <id>"
  usage-reports-assigntome: "<yellow>Usage:</yellow> /reports assigntome <id>"
  usage-reports-unassignme: "<yellow>Usage:</yellow> /reports unassignme <id>"

  # Report history (closed)
  history-page-empty: "No closed reports."
  history-page-header: "Closed Reports Page %page%/%pages%"
  already-open: "Report #%id% is already open."
  reopened: "Reopened report #%id%"
  tip-reopen: "Reopen this report"

  # Buttons / tooltips (used everywhere)
  label-expand: "^"                       # unified EXPAND label (used in lists, search, notifications)
  tip-expand: "Click to expand"
  tip-open-browser: "Open in browser"
  tip-open-login: "Open login page"
  auth-no-base-url: "<red>No public URL configured. Set public-base-url or http-server.external-base-url.</red>"
  tip-prev: "Previous page"
  tip-next: "Next page"
  tip-reload: "Reload reports"
  tip-close: "Close this report"
  tip-chat: "View chat logs"
  tip-jump-server: "Connect to this server"
  tip-assign-me: "Assign to me"
  tip-unassign: "Unassign"
  tip-force-claim: "Force-claim"
  tip-claim-highest: "Claim the highest priority report"
  tip-claimed-list: "View your claimed reports"
  tip-auth-code: "Request a chat log auth code"
  tip-reporthistory: "View closed reports"
  button-claim-highest: "Claim Highest"
  button-claimed: "Claimed"
  button-chatlog-auth: "Chat Log Auth"
  button-reporthistory: "Report History"

  # Hover tooltips for list line segments
  tip-target: "Target: %name%"
  tip-assigned: "Assigned: %name%"
  tip-server: "Server: %name%"

  # Expanded view
  expanded-header: "Report #%id% (%type% / %category%)"
  expanded-server-line: "<gray>Server:</gray> <white>%server%</white>"
  expanded-lines:
    - "<gray>Reported:</gray> <white>%target%</white> <gray>by</gray> <white>%player%</white>"
    - "<gray>When:</gray> <white>%timestamp%</white>"
    - "<gray>Count:</gray> <white>%count%</white>"
    - "<gray>Reason(s):</gray> <white>%reasons%</white>"
    - "<gray>Status:</gray> <white>%status%</white>"
    - "<gray>Assignee:</gray> <white>%assignee%</white>"

  # Chat log viewer (web and inline)
  open-chatlog-label: "Open chat log"
  auth-code-ttl-s: "120"
  jump-command-template: "/server %server%"

# ------------------------------------------------------------------------------------
# DYNAMIC REPORT TYPES
# ------------------------------------------------------------------------------------
# You can add/remove categories freely; type/category ids are what you use on /report.
report-types:
  player:
    display: "Player"
    categories:
      chat: "Chat"
      cheat: "Cheating"
      ad: "Advertising"
      grief: "Griefing"
  server:
    display: "Server"
    categories:
      crash: "Crash"
      lag: "Lag"
      dupe: "Duplication Bug"

# ------------------------------------------------------------------------------------
# STACK BADGE THRESHOLDS & COLORS (ui only)
# ------------------------------------------------------------------------------------
stack-thresholds:
  yellow: 3
  gold: 5
  red: 10
  dark-red: 15

stack-colors:
  yellow: "<yellow>"
  gold: "<gold>"
  red: "<red>"
  dark-red: "<dark_red>"
